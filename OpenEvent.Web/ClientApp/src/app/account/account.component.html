<user-nav></user-nav>

<!--<div class="display-4 m-3">Account config</div>-->

<mat-tab-group>
  <mat-tab label="Account">
    <div *ngIf="user" id="basicAccountPanel">

      <div id="avatar">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Avatar</mat-card-title>
            <mat-card-subtitle>Images must be .png format</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div id="avatarPreview">
              <image-cropper [imageChangedEvent]="imageChangedEvent" [maintainAspectRatio]="true" [aspectRatio]="1" [onlyScaleDown]="true" format="png" (imageCropped)="imageCropped($event)" [imageBase64]="user.Avatar" (loadImageFailed)="loadImageFailed()"></image-cropper>
            </div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-stroked-button (click)="avatarInput.click()">Upload file</button>
            <input hidden #avatarInput type="file" (change)="fileChangeEvent($event)"/>
            <button mat-stroked-button (click)="UpdateAvatar()">Save</button>
          </mat-card-actions>
          <mat-card-footer style="padding: 0 0.5rem 0 0.5rem;">
            <div>{{avatarFileName}}</div>
            <mat-error>{{newAvatarError}}</mat-error>
            <div class="mb-3 mx-3">
              <mat-progress-bar mode="indeterminate" *ngIf="updateAvatarLoading"></mat-progress-bar>
            </div>
          </mat-card-footer>
        </mat-card>
      </div>

      <div id="basicInfo">
        <mat-card class="mb-3">
          <mat-card-header>
            <mat-card-title>Basic Info</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-form-field appearance="outline">
              <mat-label>Email</mat-label>
              <input matInput [value]="user.Email" [disabled]="true"/>
            </mat-form-field>

            <form id="newUserName" (ngSubmit)="UpdateUserName()">
              <mat-form-field appearance="outline">
                <mat-label>User name</mat-label>
                <input matInput [value]="user.UserName" type="text" [formControl]="userName" placeholder="JoeBlogs">
                <mat-error *ngIf="username.errors && username.errors.usernameExists">
                  Username already in use
                </mat-error>
                <mat-error *ngIf="username.errors && username.errors.http">{{newUserNameError}}</mat-error>
              </mat-form-field>
              <button type="submit" mat-fab>
                <mat-icon>save</mat-icon>
              </button>
            </form>

            <mat-form-field appearance="outline">
              <mat-label>First name</mat-label>
              <input matInput [value]="user.FirstName" [disabled]="true"/>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Last name</mat-label>
              <input matInput [value]="user.LastName" [disabled]="true"/>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Phone number</mat-label>
              <input matInput [value]="user.PhoneNumber" [disabled]="true"/>
            </mat-form-field>
          </mat-card-content>

          <mat-card-footer class="mb-3 mx-3">
            <mat-progress-bar mode="indeterminate" *ngIf="updateUserNameLoading"></mat-progress-bar>
          </mat-card-footer>
        </mat-card>

        <mat-card class="mb-3">
          <mat-card-header>
            <mat-card-title>Password</mat-card-title>
            <mat-card-subtitle>Change password</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <form [formGroup]="newPasswordForm" id="newPassword" (ngSubmit)="UpdatePassword()">
              <mat-form-field appearance="outline">
                <mat-label>Password</mat-label>
                <input matInput type="password" formControlName="password" placeholder="P@ssword1">
                <mat-error>
                  Password must have 8+ characters, 1+ uppercase letter, lowercase letter, number and special character
                </mat-error>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Confirm Password</mat-label>
                <input matInput type="password" formControlName="passwordConfirm" placeholder="P@ssword1">
                <mat-error *ngIf="passwordConfirm.hasError('matches')">
                  Passwords must match
                </mat-error>
              </mat-form-field>
              <button type="submit" mat-fab>
                <mat-icon>save</mat-icon>
              </button>
              <mat-error *ngIf="newPasswordForm.errors && newPasswordForm.errors.http">{{newPasswordError}}</mat-error>
            </form>
          </mat-card-content>
          <mat-card-footer class="mb-3 mx-3">
            <mat-progress-bar mode="indeterminate" *ngIf="updatePasswordLoading"></mat-progress-bar>
          </mat-card-footer>
        </mat-card>

        <div id="accountControls">
          <button mat-stroked-button color="warn" (click)="DeleteAccount()"><span>Delete account </span>
            <mat-icon>delete</mat-icon>
          </button>
        </div>

        <div>{{deleteAccountError}}</div>
      </div>
    </div>
  </mat-tab>
  <mat-tab label="Payment Methods"></mat-tab>
  <mat-tab label="Transactions"></mat-tab>
</mat-tab-group>
